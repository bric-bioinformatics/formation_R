<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ggplot2 tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="tuto_ggplot2_files/libs/clipboard/clipboard.min.js"></script>
<script src="tuto_ggplot2_files/libs/quarto-html/quarto.js"></script>
<script src="tuto_ggplot2_files/libs/quarto-html/popper.min.js"></script>
<script src="tuto_ggplot2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tuto_ggplot2_files/libs/quarto-html/anchor.min.js"></script>
<link href="tuto_ggplot2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tuto_ggplot2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tuto_ggplot2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tuto_ggplot2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tuto_ggplot2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ggplot2 tutorial</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<style>
  details > summary {  
    padding: 4px;  
    width: 400px;  
    background-color: #E0F8EC;  
    border: none;  
    box-shadow: 1px 1px 2px #bbbbbb;  
    cursor: pointer;
    
  }
  details > p {  
    background-color: #E0F8EC;  
    padding: 4px;  
    margin: 0;  
    box-shadow: 1px 1px 2px #bbbbbb;
  }
</style>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Describe the study and the data … to be done</p>
</section>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<section id="you-first-need-to-load-the-data." class="level4">
<h4 class="anchored" data-anchor-id="you-first-need-to-load-the-data.">You first need to load the data.</h4>
<p>Follow the procedure using the interface to load the file or try to use the function <code>read.table.</code></p>
<p>Clinical data: <code>clinical_data.csv</code>, name the variable <code>clinical</code></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or you can try to adapt this code</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>clinical <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/smoking_imbalance_treatment_response_data_v2.csv"</span>,<span class="at">sep=</span><span class="st">","</span>,<span class="at">head=</span>T)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clinical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  patient_id      age gender smoking_status   height   weight
1          1 64.96714   Male         Smoker 180.9910 98.83183
2          2 58.61736   Male     Non-Smoker 162.6784 53.58433
3          3 66.47689   Male     Non-Smoker 176.1161 76.92134
4          4 75.23030   Male     Non-Smoker 165.7124 69.74749
5          5 57.65847   Male         Smoker 161.1106 70.78215
6          6 57.65863   Male     Non-Smoker 179.1095 68.22497
  blood_pressure_systolic blood_pressure_diastolic cholesterol   glucose
1               122.50182                 78.18016    203.4560  67.06891
2               109.61795                 75.56966    194.7213 103.10724
3               113.57004                 91.31688    160.4247 119.15123
4               110.89187                107.75532    145.2192 101.06535
5                98.80158                 81.78133    138.7112  89.83955
6               136.26337                 83.63899    214.1575 194.89959
  heart_rate hospital_visits_last_year     diagnosis treatment_group
1   60.04614                         2 Heart Disease         Control
2   88.67212                         6 Heart Disease          Drug B
3   83.17836                         4    No Disease         Control
4   79.68278                         2      Diabetes          Drug A
5   57.38393                         5  Hypertension          Drug A
6   96.59123                         0      Diabetes         Control
  treatment_response
1          No Change
2          No Change
3          No Change
4          No Change
5           Worsened
6          No Change</code></pre>
</div>
</div>
</section>
<section id="install-ggplot2-and-load-the-library" class="level4">
<h4 class="anchored" data-anchor-id="install-ggplot2-and-load-the-library">Install ggplot2 and load the library</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="display-your-first-plot-step-by-step" class="level2">
<h2 class="anchored" data-anchor-id="display-your-first-plot-step-by-step">Display your first plot step by step</h2>
<p>Before unfolding the code and answers boxes, try to find the solution from what we have seen in the lecture or by <strong>searching on the web</strong>, it should become an automatism, no one knows everything !</p>
<ol type="1">
<li>Use the function <code>ggplot</code> alone.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A default grey background is displayed.</p>
<ol start="2" type="1">
<li>Display the axis: Add the data and choose the x and y axis from the column names that you can display using <code>colnames</code>. For instance, we want to evaluate the distribution of the Glucose concentration (y-axis) in function of the diagnosis (x-axis).</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the column names</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(clinical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "patient_id"                "age"                      
 [3] "gender"                    "smoking_status"           
 [5] "height"                    "weight"                   
 [7] "blood_pressure_systolic"   "blood_pressure_diastolic" 
 [9] "cholesterol"               "glucose"                  
[11] "heart_rate"                "hospital_visits_last_year"
[13] "diagnosis"                 "treatment_group"          
[15] "treatment_response"       </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<details>
<summary>
Answer
</summary>
<p>The default theme displays a grey background and a white grid. We will see that is easy to change this features.</p>
<p>Note that the axis are automatically labelled with the column names.</p>
</details>
<ol start="3" type="1">
<li>Display the geometric shape: <strong>boxplot</strong></li>
</ol>
<p><strong>Add a layer</strong> to the plot. Which is the function to use ?</p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 boxplot</code></li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="customize-by-adding-layers-and-modifying-aesthetics" class="level2">
<h2 class="anchored" data-anchor-id="customize-by-adding-layers-and-modifying-aesthetics">Customize by adding layers and modifying aesthetics</h2>
<ol type="1">
<li>Change the x-axis labels: we want to make it prettier: e.g Type of Disease and the y-axis to make it more explicit: e.g Glucose (mg/dL)</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="2" type="1">
<li>Change the global theme to have a white background more suitable for figures and projection</li>
</ol>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 theme white background</code></li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="3" type="1">
<li>Change the color and fill of the boxplots</li>
</ol>
<ul>
<li>All the boxplots in red and filled with grey. You can search for how colors are named in R if you want to try your favorite colors. Many palettes are available through dedicated packages. (My favorite function to call for colors is <code>colours()</code> systematically installed and loaded with R, you can try some of my preferred ones: <code>colours()[124]</code>, <code>colours()[613]</code>, <code>colours()[53]</code>, <code>colours()[144]</code>).</li>
</ul>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 colors</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the fonction colours() returns the name of the color</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colours</span>()[<span class="dv">124</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deepskyblue3"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the function c() to concat several elements, we call it a vector</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">colours</span>()[<span class="dv">613</span>], <span class="fu">colours</span>()[<span class="dv">53</span>], <span class="fu">colours</span>()[<span class="dv">144</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "springgreen3" "chocolate1"   "gold2"       </code></pre>
</div>
</div>
<ul>
<li><code>R ggplot2 boxplot color</code></li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color=</span><span class="st">"red"</span>, <span class="at">fill=</span><span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can play globally on the color of the borders (parameter <code>color</code>), the filling (parameter <code>fill</code>), the transparency (parameter <code>alpha</code>)) and more. The accessible aesthetics can vary according to the geometric shape, form. instance for lines you will have the width and the type.</p>
<ol start="4" type="1">
<li>Change the color of the boxplots in function of the type of disease</li>
</ol>
<ul>
<li>During the previous step the same colors have been applied to all boxplots, the goal here is to use the information contained in a column of our dataset (<code>diagnosis</code>). This is part of the aesthetics. Based on the current code, how would you add this information (2 possibilities) ?</li>
</ul>
<p><strong><em>Option 1</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly in the aesthetics of the ggplot function that will be accessible for all</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># layers</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose, <span class="at">color=</span>diagnosis)) <span class="sc">+</span> <span class="co"># Add the new aesthetics color</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="co"># remove the global colors</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong><em>Option 2</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Within the geom_boxplot() function which will define the aesthetics </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with aes() only for this layer</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>By default the colors are not very contrasted … you can customize them by i) defining your own palette optionally by <strong>attributing a color to each category</strong> ; ii) find a predefined palette to help you to define the colors. To do this task, you will need to add a new layer by using a function that help in <strong>scaling the colors manually</strong>.</li>
</ul>
<p>i) To define your own palette, you need to concatenate as many colors as the number of categories, here 4 colors. You can assign the colors to the categories by building a <strong>named vector</strong>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the function c(), to name the elements of a vector you use the name you want</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and you assign the values with the sign =</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>palette.disease <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Diabetes=</span><span class="fu">colours</span>()[<span class="dv">144</span>],</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Heart Disease"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">34</span>],</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Hypertension=</span><span class="fu">colours</span>()[<span class="dv">613</span>],</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"No Disease"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">24</span>])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the content</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>palette.disease</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Diabetes  Heart Disease   Hypertension     No Disease 
       "gold2"       "brown2" "springgreen3"        "black" </code></pre>
</div>
</div>
<p>Now you have your colors, add the layer to the ggplot object and use the variable <code>palette.disease</code> you just created.</p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li>R ggplot2 scaling color manually</li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ii) R natively provides a few continuous color palettes which means that you do not need to install and load any library. Also when you install <code>ggplot2</code>, it installs some dependencies (packages that <code>ggplot2</code> needs to work properly), among them it installs the packages <code>RColorBrewer</code>, <code>viridis</code>, <code>paletteer</code>, <code>khroma</code> etc. and have implemented specific functions to use the palettes, it means that those packages are installed but not loaded. You can see which functions are available when typing <code>scale_color_</code> on RStudio. If you want to use the functions from these packages you need to load the package but it is not mandatory. Finally, a lot more palettes are available through packages.</p>
<p><strong><em>Native palettes</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rainbow, heat.colors, terrain.colors, topo.colors, cm.colors</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">terrain.colors</span>(<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong><em>Viridis palettes</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># options: viridis, magma, plasma, inferno, cividis</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option=</span><span class="st">"inferno"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="5" type="1">
<li>Customize <strong>theme</strong> elements by <strong>rotating</strong> the <strong>x-axis labels</strong> by 45°</li>
</ol>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 rotate x axis labels</code></li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">option=</span><span class="st">"inferno"</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="6" type="1">
<li>Flip the plot to get horizontal boxplots</li>
</ol>
<p>There is two ways, the first one is very simple and consists in inverting x and y aesthetics, the second one involves the <strong>addition</strong> of a new layer to <strong>flip the axis</strong> (preferred option and it provides more flexibility). Lets keep our own color palette <code>palette.disease</code></p>
<p><strong><em>Option 1</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">y=</span>diagnosis, <span class="at">x=</span>glucose)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong><em>Option 2</em></strong></p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 flip axis</code></li>
</ul>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="7" type="1">
<li>Add another geometric shape: points</li>
</ol>
<p>This task consist of <strong>adding a new layer</strong> containing the points colored by known oncogenes. Which function should we use ? Note that there are two answers but one is more suitable for boxplot as it is adding some random noise to the positions in order to avoid overlaps. Set the <strong>size</strong> of the points to <code>0.3</code></p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<ul>
<li><code>R ggplot2 point</code></li>
<li><code>R ggplot2 point boxplot</code></li>
</ul>
</details>
<p><strong><em>Option 1</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis), <span class="at">size=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong><em>Option 2</em></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis), <span class="at">size=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="8" type="1">
<li>The boxplots are no more visible. Find a way to make them visible. Play with <strong>opacity</strong> both in boxplots and points.</li>
</ol>
<details>
<summary>
Tips
</summary>
<p>We use layers that we stack one above the other.</p>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis, <span class="at">y=</span>glucose)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis), <span class="at">size=</span><span class="fl">0.3</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis),<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>, <span class="at">y=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="create-a-density-plot" class="level2">
<h2 class="anchored" data-anchor-id="create-a-density-plot">Create a density plot</h2>
<p>Your goal is to produce the following density plot showing the <strong>density distributions</strong> of the glucose concentration in function of the diseases (use <code>palette.disease</code>). Here we introduce the customization of the plot dimensions, we want to force the plot to have be x-axis 2 times longer than the y-axis which we call the <strong>aspect ratio</strong>. Thanks to it, you can force to have squared plots for instance.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol type="1">
<li>Identify what contain the axis.</li>
</ol>
<details>
<summary>
Answer
</summary>
<p>The x-axis contains the value of the column <code>glucose</code> and the y-axis indicates the density of the distribution, the y-axis do not need to be specified.</p>
</details>
<ol start="2" type="1">
<li>Make a list of the aesthetics you need to modify and layers that need to be added.</li>
</ol>
<details>
<summary>
Answer
</summary>
<ul>
<li><p>layers: the geometric shape, label of the x-axis, theme background, theme aspect ratio, custom color palette</p></li>
<li><p>aesthetics: x-axis , color of the lines</p></li>
</ul>
</details>
<ol start="3" type="1">
<li>Write your code ! (Do not forget your best friend: the Web)</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>glucose)) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">color=</span>diagnosis)) <span class="sc">+</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Glucose (mg/dL)"</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="create-a-bar-plot" class="level2">
<h2 class="anchored" data-anchor-id="create-a-bar-plot">Create a bar plot</h2>
<p>Your goal is to produce the following <strong>bar plot</strong> showing the number of patient that are smoking (column <code>smoking_status</code> - play with the <strong>transparency</strong>) in each outcome. In this case the <strong>aspect ratio</strong> is inverse compared to the previous one.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol type="1">
<li>Identify what contain the axis.</li>
</ol>
<details>
<summary>
Answer
</summary>
<p>The x-axis indicates the number of sample falling in the different outcomes, the x-axis do not need to be specified. The y-axis indicates the different outcomes. As a reminder, one would prefer to flip the coordinates but it is not mandatory.</p>
</details>
<ol start="2" type="1">
<li>Make a list of the aesthetics you need to modify and layers that need to be added.</li>
</ol>
<details>
<summary>
Answer
</summary>
<ul>
<li><p>layers: the geometric shape, label of the y-axis, theme background, theme aspect ratio, custom color palette</p></li>
<li><p>aesthetics: y-axis , color of the lines, fill of the bars, transparency according to gender</p></li>
</ul>
</details>
<ol start="3" type="1">
<li>Write your code ! (Do not forget your best friend: the Web)</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>treatment_response)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>treatment_response, <span class="at">color=</span>treatment_response,<span class="at">alpha=</span>smoking_status)) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Outcomes"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>What happens if you set the parameter of the argument <code>position</code> in the geometric layer to <code>fill</code> ?</li>
</ol>
<details>
<summary>
Answer
</summary>
<p>The y-axis shows now proportions instead of absolute values. It highlights a higher proportion of smokers in the group of worsened outcomes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>treatment_response)) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>treatment_response, <span class="at">color=</span>treatment_response,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Outcomes"</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<ol start="5" type="1">
<li>What happens if you set the coordinates with <code>coord_polar(theta="y")</code> instead of <code>coord_flip()</code> ?</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>treatment_response)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>treatment_response, <span class="at">color=</span>treatment_response,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Outcomes"</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta=</span><span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Answer
</summary>
<p>We obtain a pie chart ! Note that we have modified the <code>theme</code> to remove all axis and labels.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<ol start="6" type="1">
<li>Does the smoking status seem to be associated with other factors ?</li>
</ol>
<p>We could plot the <strong>proportion</strong> of smokers in each category.</p>
<p><strong><em>Option 1 (not recommended)</em></strong></p>
<p>You can plot independently the four barplots.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>treatment_response)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>treatment_response, <span class="at">color=</span>treatment_response,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Outcomes"</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Worsened=</span><span class="st">"red"</span>,<span class="st">"No Change"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="at">Improved=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>gender)) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>gender, <span class="at">color=</span>gender,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Patient Gender"</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Male=</span><span class="st">"red"</span>,<span class="at">Female=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Male=</span><span class="st">"red"</span>,<span class="at">Female=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>diagnosis)) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>diagnosis, <span class="at">color=</span>diagnosis,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Type of Disease"</span>) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.disease) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> clinical, <span class="fu">aes</span>(<span class="at">x=</span>treatment_group)) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>treatment_group, <span class="at">color=</span>treatment_group,<span class="at">alpha=</span>smoking_status), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Treatment group"</span>) <span class="sc">+</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Control=</span><span class="st">"red"</span>,<span class="st">"Drug B"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="st">"Drug A"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Control=</span><span class="st">"red"</span>,<span class="st">"Drug B"</span><span class="ot">=</span><span class="st">"darkgrey"</span>,<span class="st">"Drug A"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">613</span>])) <span class="sc">+</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong><em>Option 2 (recommended)</em></strong></p>
<p><strong>Our goal</strong> is to obtain a table in which we have all combinations of smoking habits and other features for each patient, in other words we want a line per feature and its measure in each patient and its smoking habit. The column containing the features (gender, diagnosis, treatment_group, treatment_response) will be use to split the plot into 4 panels, one per feature. This is called <strong><em>faceting</em></strong>.</p>
<p>i) We will first extract a <code>data.frame</code> containing the qualitative values and store it in a variable named <code>qual.features</code>. To do that use the functions provided by <a href="./tuto_dplyr.html">dplyr</a>.</p>
<details>
<summary>
Tips
</summary>
<p>You need to use a combination of functions that allows to select columns according to a type of variable. You can find the answer in the dplyr tutorial or on the web helped or not by an artificial intelligence.</p>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>qual.features <span class="ot">&lt;-</span> clinical <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">where</span>(is.numeric))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(qual.features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  gender smoking_status     diagnosis treatment_group treatment_response
1   Male         Smoker Heart Disease         Control          No Change
2   Male     Non-Smoker Heart Disease          Drug B          No Change
3   Male     Non-Smoker    No Disease         Control          No Change
4   Male     Non-Smoker      Diabetes          Drug A          No Change
5   Male         Smoker  Hypertension          Drug A           Worsened
6   Male     Non-Smoker      Diabetes         Control          No Change</code></pre>
</div>
</div>
<p>ii) We will <strong>“lengthens”</strong> the dataset <code>qual.features</code> so that we obtain a <strong>longer</strong> <code>data.frame</code> (named <code>qual.features.long</code>) where you will have the measures corresponding the smoking status and all other measures. The <code>smoking_status</code> column should be kept in the final table, the other features should be stored in a new column named <code>features</code> and the values stored in a column named <code>values</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       smoking_status           features        values
               &lt;char&gt;             &lt;char&gt;        &lt;char&gt;
    1:         Smoker             gender          Male
    2:         Smoker          diagnosis Heart Disease
    3:         Smoker    treatment_group       Control
    4:         Smoker treatment_response     No Change
    5:     Non-Smoker             gender          Male
   ---                                                
39996:     Non-Smoker treatment_response     No Change
39997:     Non-Smoker             gender        Female
39998:     Non-Smoker          diagnosis Heart Disease
39999:     Non-Smoker    treatment_group       Control
40000:     Non-Smoker treatment_response     No Change</code></pre>
</div>
</div>
<p><strong><em>=&gt; Modify dataset layout with <code>pivot_longer()</code> and <code>pivot_wider()</code></em></strong></p>
<p>We can change the layout of a dataset. It means, for example, transform columns into rows or the invert. This is a common task in data analysis, particularly when you need to organize data in a structure that is best suited for your analysis.</p>
<p>In R, this often involves transforming data between long and wide format. In a <strong><em>wide format</em></strong>, each row represent a single observation, and columns represent variables (like in <code>qual.features</code>). In a <strong><em>long format</em>,</strong> each row is a single measurement, with a separate column for the variables and the values. This structure is particularly useful for certain graphical representations.</p>
<p>To switch from one shape to another, there are two functions called <code>pivot_longer()</code> and <code>pivot_wider()</code>. <code>pivot_longer``()</code> function enables to convert multiple columns into key-value pairs, where column names become variable names, and their corresponding values are stacked. <code>pivot_wider()</code> function allows to spread key-value pairs across multiple columns. We say that <code>pivot_longer``()</code> reshapes wide format to long format and <code>pivot_wider()</code> do the invert.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures_merging/pivot_tidyr_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Schematic view of wide and long formats</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>long_tab <span class="ot">&lt;-</span> wide_tab <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_longer</span>(<span class="sc">!</span>smoking_status,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"features"</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"values"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>wide_tab <span class="ot">&lt;-</span> long_tab <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="st">"features"</span>, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try to play the <code>pivot_longer()</code> command as it is (don’t forget to use our data) … you obtain an error:</p>
<div style="background-color:LemonChiffon;line-height:0.6;">
<p>Error in <code>pivot_longer()</code>:</p>
<p>! Arguments in <code>...</code> must be used.</p>
<p>✖ Problematic arguments:</p>
<p>• ..1 = “features”</p>
<p>• ..2 = “values”</p>
<p>ℹ Did you misspell an argument name?</p>
<p>Run <code>rlang::last_trace()</code> to see where the error occurred.</p>
</div>
<p>Explore the <code>pivot_longer()</code> functions and identify the names of the parameters that are set in the figure example. Describe what is happening.</p>
<details>
<summary>
Answer
</summary>
<p>Search on the web or look at the help of each function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>?pivot_longer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In R, when the names of the parameters are not indicated, the order of the arguments is very important. It will correspond to the order of the arguments defined in the function.</p>
<p>The first parameter <code>data</code> is automatically filled by the stream <code>%&gt;%</code> and take the data frame <code>qual.features</code>.</p>
<p>The second parameter <code>cols</code> do not have default argument and will take the first argument specified in the command: <code>!smoking_status</code>.</p>
<p>This argument indicates the column that should <strong>NOT</strong> be spread (the logical <strong>NO</strong> <code>!</code> makes the negation), indeed we want to keep this column in the resulting table as it will be use as a layer in our plot. If the <code>!</code> was not present than the specified columns are spread.</p>
<p>The third parameter <strong><code>...</code></strong> is specifically designed for additional column selectors, this means you can use multiple column selection methods or helpers (like <code>starts_with()</code>, <code>contains()</code>, etc.) to specify the columns to be pivoted, but most of the time you can achieve your goal with just <strong><code>cols</code></strong>, as the need for <strong><code>...</code></strong> is rare in practice for this function. The argument <code>"features"</code> and <code>"values"</code> in <strong><code>...</code></strong> are not being correctly understood by the function. No such functions exist. It is what the error says:</p>
<div style="background-color:LemonChiffon;line-height:0.6;">
<p>! Arguments in <code>...</code> must be used.</p>
<p>✖ Problematic arguments:</p>
<p>• ..1 = “features”</p>
<p>• ..2 = “values”</p>
</div>
<p>From here you need to find the appropriate arguments to set the name of the column that will contain the column names to <code>features</code> and set the name of the column that will contain the values corresponding to the pairs <code>smoking_status</code>-<code>features</code> to <code>values</code>.</p>
<p>Here it is the answer:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>qual.features.long <span class="ot">&lt;-</span> qual.features <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude smoking_status, pivot other columns</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span>smoking_status,    </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A character vector specifying the new column or columns to create from </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the information stored in the column names of data specified by cols.</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"features"</span>,    </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A string specifying the name of the column to create from the data stored in cell values.</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"values"</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</details>
<p>At least two othe ways of writing the code are possible</p>
<p><em>Way 1</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specifying the columns to pivot</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>qual.features.long <span class="ot">&lt;-</span> qual.features <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(gender,diagnosis,treatment_group,treatment_response),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"features"</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Way 2</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># relocate smoking_status at the first column and spread from column gender to treatment_response</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>qual.features.long <span class="ot">&lt;-</span> qual.features <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">relocate</span>(smoking_status,<span class="at">.before =</span> gender) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">pivot_longer</span>(cols<span class="sc">:</span>gender<span class="sc">:</span>treatment_response,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">names_to =</span> <span class="st">"features"</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">values_to =</span> <span class="st">"values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can note that the number of rows after gathering is equals to the number of rows in the original data (<code>10000</code>) times the number of gathered columns (<code>4</code>) reflecting all the combinations of <code>smoking_status</code> and all 4 features for each patient.</p>
<p>iii) We will plot the <strong>proportion</strong> of smokers (<strong>opacity</strong>) in each category value, using <strong>faceting</strong> to <strong>wrap</strong> the other features.</p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<p>R wrap facet ggplot2</p>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qual.features.long,<span class="fu">aes</span>(<span class="at">x=</span>values)) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">alpha=</span>smoking_status, <span class="at">color=</span>values, <span class="at">fill=</span>values), <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>features,<span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="correlation-between-quantitative-features" class="level2">
<h2 class="anchored" data-anchor-id="correlation-between-quantitative-features">Correlation between quantitative features</h2>
<section id="what-plots-are-behind-these-codes" class="level4">
<h4 class="anchored" data-anchor-id="what-plots-are-behind-these-codes">What plots are behind these codes ?</h4>
<p>Analyse the following code chunks, comment all the layers of each plot, which plots would you expect ? What do you need to be able to run these codes. Ask the web or chatGPT !</p>
<p><strong><em>Plot 1</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(clinical, <span class="at">x=</span><span class="st">"cholesterol"</span>, <span class="at">y=</span><span class="st">"heart_rate"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">add=</span><span class="st">"reg.line"</span>) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>smoking_status,<span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_cor</span>(<span class="at">label.y =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Plot 2</em></strong></p>
<p>Comment also the lines before making the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggviolin</span>(clinical, <span class="at">x =</span> <span class="st">"treatment_response"</span>, <span class="at">y =</span> <span class="st">"age"</span>, <span class="at">fill =</span> <span class="st">"treatment_response"</span>, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>         <span class="co">#palette = c(high=colours()[124],low=colours()[144]),</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">add =</span> <span class="st">"boxplot"</span>, <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(treatment_group<span class="sc">~</span>smoking_status) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">30</span>,<span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"No Change"</span>,<span class="st">"Worsened"</span>),<span class="fu">c</span>(<span class="st">"No Change"</span>,<span class="st">"Improved"</span>),<span class="fu">c</span>(<span class="st">"Improved"</span>,<span class="st">"Worsened"</span>)), <span class="at">method=</span><span class="st">"wilcox"</span>, <span class="at">label.y =</span> <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">130</span>,<span class="dv">110</span>), <span class="at">label=</span><span class="st">"p.signif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-plot" class="level4">
<h4 class="anchored" data-anchor-id="correlation-plot">Correlation plot</h4>
<p>Using <code>dplyr</code> functions, <strong>select</strong> columns containing <strong>numeric</strong> values in <code>clinical</code>. Caution, the <code>patient_id</code> column contains numeric and we do not want it, we need to combine 2 conditions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>quant.features <span class="ot">&lt;-</span> clinical <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span>patient_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You have a very nice introduction to this package: <a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html" class="uri">https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html</a>. All the informations are in this page but don’t hesitate to search for more.</p>
<p>You want to obtain the following plot:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here is the solution:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install the package that is in CRAN repository</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"corrplot"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load the library</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the correlation, by default it compute the correlation between columns</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">cor</span>(quant.features) </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the plot !</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(M, <span class="at">method =</span> <span class="st">'square'</span>, <span class="at">addCoef.col =</span> <span class="st">'black'</span>, <span class="at">order =</span> <span class="st">'AOE'</span>, <span class="at">type =</span> <span class="st">'upper'</span>, <span class="at">diag =</span> F, <span class="at">cl.pos =</span> <span class="st">'b'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise" class="level2">
<h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<section id="you-first-need-to-load-the-data.-1" class="level4">
<h4 class="anchored" data-anchor-id="you-first-need-to-load-the-data.-1">You first need to load the data.</h4>
<p>Follow the procedure using the interface to load the file or try to use the function <code>read.table.</code></p>
<p>Clinical data: <code>TCGA_LUAD_subset.tsv</code>, name the variable <code>luad_clinical</code></p>
<p>Expression data : <code>TCGA_LUAD_expression.tsv,</code> name the variable <code>luad_expr</code></p>
<p>Differential Expression Gene in KRAS tumors between high and low MAPK signature : <code>TCGA_KRAS_DEG_MAPK.tsv</code>, name the variable <code>KRAS_DEG</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or you can use R command</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>luad_clinical <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/TCGA_LUAD_subset.tsv"</span>,<span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="at">head=</span>T)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>luad_expr <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/TCGA_LUAD_expression.tsv"</span>,<span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="at">head=</span>T,<span class="at">row=</span><span class="dv">1</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>KRAS_DEG <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/TCGA_KRAS_DEG_MAPK.tsv"</span>,<span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="at">head=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="questions-all-answers-are-plots" class="level4">
<h4 class="anchored" data-anchor-id="questions-all-answers-are-plots">Questions (<em>all answers are plots</em>)</h4>
<p>The solutions we provide are not the unique possibilities to represent the data in order to evaluate or show tendencies.</p>
<details>
<summary>
Here are some colors you could use …
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># colours for oncogenes</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>palette.known.onco <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">ALK=</span><span class="st">"darkgrey"</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">BRAF_act=</span><span class="fu">colours</span>()[<span class="dv">613</span>],</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">BRAF.non=</span><span class="fu">colours</span>()[<span class="dv">11</span>],</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">EGFR=</span><span class="fu">colours</span>()[<span class="dv">128</span>],</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ERBB2=</span><span class="fu">colours</span>()[<span class="dv">76</span>],</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">MAP2K1=</span><span class="fu">colours</span>()[<span class="dv">509</span>],</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">MET=</span><span class="fu">colours</span>()[<span class="dv">121</span>],</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">NF1=</span><span class="fu">colours</span>()[<span class="dv">468</span>],</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">None=</span><span class="fu">colours</span>()[<span class="dv">92</span>],</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">RIT1=</span><span class="fu">colours</span>()[<span class="dv">642</span>],</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ROS1=</span><span class="fu">colours</span>()[<span class="dv">34</span>],</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">KRAS=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol type="1">
<li>Are the oncogenes (column <code>known.oncogenes</code>) evenly represented in the dataset ?</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> luad_clinical, <span class="fu">aes</span>(<span class="at">x=</span>known.oncogenes)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>known.oncogenes)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Known Oncogenes"</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>palette.known.onco) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Are there differences in MAPK activity (column <code>signature_MAPK</code>) in tumors depending on the mutated oncogene they are harboring (column <code>known.oncogenes</code>) ?</li>
</ol>
<p><em>Solution 1</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> luad_clinical, <span class="fu">aes</span>(<span class="at">x=</span>known.oncogenes, <span class="at">y=</span>signature_MAPK)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color=</span>known.oncogenes)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Known Oncogenes"</span>, <span class="at">y=</span><span class="st">"MAPK activity signature"</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.known.onco) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color=</span>known.oncogenes)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">median</span>(luad_clinical<span class="sc">$</span>signature_MAPK), <span class="at">linewidth=</span><span class="fl">0.3</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Solution 2</em></p>
<p>This solution implies a preliminary step during which you need to transform the data by summarizing the values by known oncogenes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>mapk_activity_per_oncogenes <span class="ot">&lt;-</span> luad_clinical <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(known.oncogenes) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize</span>(<span class="at">mapk_sd_low=</span><span class="fu">mean</span>(signature_MAPK)<span class="sc">-</span><span class="fu">sd</span>(signature_MAPK),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mapk_mean=</span><span class="fu">mean</span>(signature_MAPK),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mapk_sd_high=</span><span class="fu">mean</span>(signature_MAPK)<span class="sc">+</span><span class="fu">sd</span>(signature_MAPK))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mapk_activity_per_oncogenes, <span class="fu">aes</span>(<span class="at">x=</span>known.oncogenes, <span class="at">y=</span>mapk_mean)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill=</span>known.oncogenes, <span class="at">color=</span>known.oncogenes),<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mapk_sd_low,<span class="at">ymax=</span>mapk_sd_high, <span class="at">color=</span>known.oncogenes),<span class="at">width =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Known Oncogenes"</span>, <span class="at">y=</span><span class="st">"Average MAPK activity signature"</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>palette.known.onco) <span class="sc">+</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.known.onco) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Researchers are particularly interested in some regulators of the MAPK signaling, among them we focus on <em>DUSP4</em>, <em>DUSP6</em>, <em>SPRY2</em>. How the expression of these genes globally correlates with the MAPK signature ?</li>
</ol>
<p>3.1. Select the rows corresponding the phosphatase genes in the expression matrix, <strong>transpose</strong> the table, change its type to <code>data.frame</code> and add a column named <code>sampleID</code> containing the row names.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>phospho.expression <span class="ot">&lt;-</span> luad_expr[<span class="fu">c</span>(<span class="st">"DUSP4"</span>,<span class="st">"DUSP6"</span>,<span class="st">"SPRY2"</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>phospho.expression <span class="ot">&lt;-</span> <span class="fu">t</span>(phospho.expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>phospho.expression <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phospho.expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>phospho.expression<span class="sc">$</span>sampleID <span class="ot">&lt;-</span> <span class="fu">row.names</span>(phospho.expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>3.2. Associate the expression of the genes to the clinical table and select the columns of interest.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>luad_clinical <span class="ot">&lt;-</span> <span class="fu">merge</span>(luad_clinical,phospho.expression, <span class="at">by=</span><span class="st">"sampleID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>luad_clinical.genes <span class="ot">&lt;-</span> luad_clinical <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"DUSP"</span>),SPRY2,signature_MAPK)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>3.3. Compute and display the correlation between gene expression and MAPK activity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">cor</span>(luad_clinical.genes)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(M, <span class="at">order =</span> <span class="st">'AOE'</span>,<span class="at">lower.col =</span> <span class="fu">COL2</span>(<span class="st">"BrBG"</span>),<span class="at">upper.col =</span> <span class="fu">COL2</span>(<span class="st">"BrBG"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Are these tendencies shared by the 4 most represented oncogenes ?</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>nb.per.onco <span class="ot">&lt;-</span> luad_clinical <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(known.oncogenes, <span class="at">name =</span> <span class="st">"nb"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(nb, <span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>luad_clinical.genes.select <span class="ot">&lt;-</span> luad_clinical <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"DUSP"</span>), SPRY2),<span class="at">names_to =</span> <span class="st">"SYMBOL"</span>,<span class="at">values_to =</span> <span class="st">"expression"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(known.oncogenes<span class="sc">%in%</span>nb.per.onco<span class="sc">$</span>known.oncogenes)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(luad_clinical.genes.select, <span class="at">x=</span><span class="st">"expression"</span>, <span class="at">y=</span><span class="st">"signature_MAPK"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">add=</span><span class="st">"reg.line"</span>, <span class="at">color =</span> <span class="st">"known.oncogenes"</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SYMBOL<span class="sc">~</span>known.oncogenes) <span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>palette.known.onco) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_cor</span>(<span class="at">label.y =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Which genes are the most significantly (top 10) associated with MAPK signature in KRAS patients ?</li>
</ol>
<details>
<summary>
Plot idea
</summary>
<p>You could display the genes in a volcano plot and add labels to the top 10 genes.</p>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>top_10 <span class="ot">&lt;-</span> KRAS_DEG <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(P.adjusted,<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>KRAS_DEG <span class="ot">&lt;-</span> KRAS_DEG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sig=</span><span class="fu">ifelse</span>(P.adjusted<span class="sc">&lt;</span><span class="fl">0.01</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(logFC)<span class="sc">&gt;</span><span class="dv">1</span>, <span class="st">"significant"</span>,<span class="st">"no"</span>))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(KRAS_DEG, <span class="fu">aes</span>(<span class="at">x=</span>logFC, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(P.adjusted))) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.6</span>, <span class="fu">aes</span>(<span class="at">color=</span>sig)) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">linewidth=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>top_10, <span class="fu">aes</span>(<span class="at">label=</span>ID)) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">significant=</span><span class="st">"red"</span>, <span class="at">none=</span><span class="st">"darkgrey"</span>)) <span class="sc">+</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Log Fold Change"</span>) <span class="sc">+</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="bonus-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="bonus-heatmap">Bonus: Heatmap</h2>
<p>In this section, we want to visualise the gene expression across all samples using a heatmap and highlight potential expression patterns using sample and gene clustering.</p>
<details>
<summary>
What is a heatmap ?
</summary>
<p>In a heatmap, <strong>each row</strong> usually represents a <strong>gene</strong>. Each <strong>column</strong> represents a <strong>sample</strong>. The rectangles containing the values are also called “cells”.</p>
<p>The <strong>colour and intensity</strong> of the cells is used to represent values of <strong>gene expression</strong>. So, basically, instead of numbers, we use colours. The colour will be more <strong>intense</strong> the lower (or higher) the value is.</p>
<p>To see patterns, we cluster (meaningful <strong>reordering</strong>) the rows and columns. This just means we <strong>group</strong> the samples and/or genes together based on the <strong>similarity</strong> of their gene expression pattern. The <strong>dendograms</strong> on the sides just indicate the results of clustering both genes and samples.</p>
<p>A clustering algorithm will group genes with a similar expression across samples together: groups of genes that are highly expressed in some samples, and lowly expressed in other samples will be clustered together. In a similar way, samples with a similar expression pattern (in general having certain sets of genes highly expressed and certain sets of genes lowly expressed) will be clustered together.</p>
<p>In summary, adding <strong>clustering</strong> to heatmaps can be useful for identifying genes that are commonly regulated, or biological signatures associated with a particular condition (for example, high MAPK activity).</p>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>Step by step</em></p>
<p><strong><em>Before starting …</em></strong></p>
<p>i) We need to find a package that allow us to draw (pretty) annotated heatmaps. Lets search on the web what we could try.</p>
<details>
<summary>
Key words to write on your favorite browser
</summary>
<p>R How to draw annotated heatmap</p>
</details>
<details>
<summary>
The package we will be using
</summary>
<p><code>pheatmap</code></p>
</details>
<p>ii) Install the package.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong><em>Step 1 : Prepare the data</em></strong></p>
<p>To be able to annotate the heatmap we need to build the annotations for the samples (<code>luad_clinical</code>) and the genes of interest (<em>DUSP4</em>, <em>DUSP6</em> and <em>SPRY2</em>) and associate colours to the categories for each feature.</p>
<p>i) Annotation of the samples</p>
<p>Using the variable <code>clinical</code>, extract the the columns known.oncogenes, pathologic_stage, gender, signature_group in a new variable <code>anno.columns</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>gene.of.interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DUSP6"</span>, <span class="st">"SPRY2"</span>,<span class="st">"DUSP4"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>anno.columns <span class="ot">&lt;-</span> luad_clinical[,<span class="fu">c</span>(<span class="st">"known.oncogenes"</span>,<span class="st">"pathologic_stage"</span>,<span class="st">"gender"</span>)]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anno.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  known.oncogenes pathologic_stage gender
1            KRAS         Stage IB   MALE
2            KRAS       Stage IIIA FEMALE
3            RIT1       Stage IIIA   MALE
4        BRAF_act         Stage IA   MALE
5            KRAS         Stage IB FEMALE
6            KRAS       Stage IIIB   MALE</code></pre>
</div>
</div>
<p>To allow the tool to map the annotations to the samples in the expression dataset, we need to name the row with the sample identifiers that are stored in the column sampleID of <code>clinical</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(anno.columns) <span class="ot">&lt;-</span> luad_clinical<span class="sc">$</span>sampleID</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anno.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                known.oncogenes pathologic_stage gender
TCGA.05.4249.01            KRAS         Stage IB   MALE
TCGA.05.4250.01            KRAS       Stage IIIA FEMALE
TCGA.05.4384.01            RIT1       Stage IIIA   MALE
TCGA.05.4389.01        BRAF_act         Stage IA   MALE
TCGA.05.4390.01            KRAS         Stage IB FEMALE
TCGA.05.4395.01            KRAS       Stage IIIB   MALE</code></pre>
</div>
</div>
<p>To define the colours for each feature, you need to build a list using the constructor function <code>list()</code> in which each element will be a named vector of colors as you have already made to create <code>palette.known.onco</code>. For that you have to know all possible categories for each feature. <code>table()</code> is an easy and very useful function to display all categories with the number of sample per category.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(anno.columns<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FEMALE   MALE 
   122    124 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(anno.columns<span class="sc">$</span>pathologic_stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Stage I   Stage IA   Stage IB  Stage IIA  Stage IIB Stage IIIA Stage IIIB 
         3         58         68         21         36         40          6 
  Stage IV 
        14 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(anno.columns<span class="sc">$</span>pathologic_stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Stage I   Stage IA   Stage IB  Stage IIA  Stage IIB Stage IIIA Stage IIIB 
         3         58         68         21         36         40          6 
  Stage IV 
        14 </code></pre>
</div>
</div>
<p>etc</p>
<p>You can see that for the pathological stages, there are subcategories A and B that we want to regroup in order to simplify the visualisation. To group the sub-categories, we will remove the A and B from the end of the words using the function <code>sub()</code>. Try to write the code, many answers are possible.</p>
<p>Here are 2 possibilities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>anno.columns<span class="sc">$</span>pathologic_stage <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"A"</span>,<span class="st">""</span>,anno.columns<span class="sc">$</span>pathologic_stage)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>anno.columns<span class="sc">$</span>pathologic_stage <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"B"</span>,<span class="st">""</span>,anno.columns<span class="sc">$</span>pathologic_stage)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The cleanest way of coding this task is</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>anno.columns<span class="sc">$</span>pathologic_stage <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"[AB]$"</span>,<span class="st">""</span>,anno.columns<span class="sc">$</span>pathologic_stage)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [AB] indicates that at the last position (sign $) you encounter either A or B</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(anno.columns<span class="sc">$</span>pathologic_stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Stage I  Stage II Stage III  Stage IV 
      129        57        46        14 </code></pre>
</div>
</div>
<p>ii) Annotations of the genes</p>
<p>We want to identify the genes belonging to the MAPK activity signature. To this end, we create a <code>data.frame</code> using the constructor function <code>data.frame()</code> with the <strong>row names</strong> corresponding to the gene names and containing one column <code>in.signature</code> containing yes or no.</p>
<p>Create a vector containing “yes” or “no” depending on the gene presence in the signature. Many possibilities exist but the best way is to use the function <code>ifelse()</code>. This function takes 3 arguments, an expression <strong>comparing</strong> the gene names (row names of the table <code>luad_expr</code>) with the genes of interest (<code>gene.of.interest</code>), what the function must return if the comparison is TRUE (the gene is in the signature, “yes”), what the function must return if the comparison is FALSE (the gene is not in the signature, “no”).</p>
<p>To know if the elements of a vector are present in an other vector we use the operator <strong>%in%</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>genes.in.signature <span class="ot">&lt;-</span> <span class="fu">row.names</span>(luad_expr) <span class="sc">%in%</span> gene.of.interest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try to write the code that allow to obtain the yes/no vector using <code>ifelse()</code> and <code>genes.in.signature</code> and keep the results in a variable called <code>in.signature</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>in.signature <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(genes.in.signature,<span class="st">"yes"</span>,<span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you can create the <code>data.frame</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create annotation for the rows containing the genes: </span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we want to indcate the genes involved in the signature</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>anno.rows <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names=</span><span class="fu">row.names</span>(luad_expr),in.signature)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anno.rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       in.signature
HLF              no
SIDT1            no
KCNK5            no
NT5E             no
ANKFN1           no
OSR2             no</code></pre>
</div>
</div>
<p>Create a list <code>colors.anno</code>, specifying the colors of each category of each feature</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a list containing the colors for each feature</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>colors.anno <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">known.oncogenes=</span>palette.known.onco,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pathologic_stage=</span><span class="fu">c</span>(<span class="st">"Stage I"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">404</span>], </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Stage II"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">33</span>], </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Stage III"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">35</span>], </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Stage IV"</span><span class="ot">=</span><span class="fu">colours</span>()[<span class="dv">24</span>]),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">gender=</span><span class="fu">c</span>(<span class="at">FEMALE=</span><span class="fu">colours</span>()[<span class="dv">613</span>], <span class="at">MALE=</span><span class="fu">colours</span>()[<span class="dv">290</span>]),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">in.signature=</span><span class="fu">c</span>(<span class="at">yes=</span><span class="st">"black"</span>,<span class="at">no=</span><span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Step 2 : Create a clustered heatmap</em></strong></p>
<p>Display the heatmap with default parameters (do not change any parameters) using the function <code>pheatmap()</code> and the expression object <code>luad_expr</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(luad_expr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>By default, pheatmap applies hierarchical clustering to both rows and columns. The parameter names are quite explicit.</p>
<p>By looking at the help of the function (<code>?pheatmap</code>) or online, identify the parameters and their default values that:</p>
<ul>
<li>Enable row or column clustering (2 parameters)</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>cluster_cols = TRUE
cluster_rows = TRUE</code></pre>
</details>
<ul>
<li>specify the statistics to compute the distances between rows or columns (2 parameters)</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>clustering_distance_rows = "euclidean"
clustering_distance_cols = "euclidean"</code></pre>
</details>
<ul>
<li>specify how to aggregate the rows and columns based on their distance (1 parameters)</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>clustering_method = "complete"</code></pre>
</details>
<p><strong><em>Step 2 : Customize your heatmap</em></strong></p>
<p>By analysing the default heatmap, we can notice that column labels are not readable and are not adding relevant information, we want to remove them, the row names are readable but we want to decrease the size of the font. We will test different method for clustering the rows and columns. We would like to change the colors of the cells to make them more divergent using for instance the color palette from <code>viridis</code> and we want to intensify the differences by lowering the range value amplitude (between -4 and 4), meaning that values outside of this range will display the extreme colors. We then want to annotate the samples and genes with nice colors, separate the clusters and finally add a tittle.</p>
<p><em>i) Row and column names</em></p>
<p>By looking at the help of the function (<code>?pheatmap</code>) or online, identify the parameters (and adapt their values) that:</p>
<ul>
<li>Enable the display of the column names and disable it.</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>show_colnames = T # default</code></pre>
</details>
<ul>
<li>Enable to decrease the font size</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>fontsize = 10 # default</code></pre>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(luad_expr,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, <span class="co"># set to FALSE if you want to remove the dendograms</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> F, <span class="co"># displaying column names</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> T, <span class="co"># displaying row names</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize =</span> <span class="dv">8</span> <span class="co"># change font size</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="tuto_ggplot2_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>ii) Change the colors</em></p>
<p>By looking at the help of the function (<code>?pheatmap</code>) or online, identify the parameters (and adapt their values) that:</p>
<ul>
<li>Enable to set the color palette. In the example we used the inferno palette from the package viridis and asked for 100 colors.</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100) # Default</code></pre>
</details>
<ul>
<li>Enable to change the amplitude of the colors between -4 and 4</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code>breaks = NA # default</code></pre>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(luad_expr,</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, <span class="co"># set to FALSE if you want to remove the dendograms</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> F, <span class="co"># displaying column names</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> T, <span class="co"># displaying row names</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> viridis<span class="sc">::</span><span class="fu">inferno</span>(<span class="dv">100</span>), <span class="co"># choose a colour scale for your data</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.08</span>), <span class="co"># seq produce a vector from -4 to 4 with a step of 0.08 (100 values)</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize =</span> <span class="dv">8</span> <span class="co"># change font size</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>iii) Choose the clustering methods</em></p>
<p>Using the parameters you identified earlier for clustering methods, test several combinations to observe the impact on the results. You can find bellow the definition of the different methods. In the example, we chose to cluster following the <code>correlation</code> <em>distance</em> and the <code>ward.D</code> <em>agglomeration</em> methods.</p>
<details>
<summary>
Distance methods
</summary>
<p><strong>Euclidean Distance</strong>: This is like drawing a straight line between two points. It’s the most intuitive way to measure distance, like the shortest path “as the crow flies” between two locations on a map.</p>
<p><strong>Manhattan Distance</strong>: Think of how you would walk in a city laid out like a grid, where you can only move horizontally or vertically. The Manhattan distance measures the total number of blocks you would walk.</p>
<p><strong>Correlation Distance</strong>: Instead of focusing on actual distance, this measures how similar the patterns or trends are between points. It’s useful when you care about how things change together rather than how far apart they are.</p>
<p><strong>Maximum Distance (Chebyshev)</strong>: This only looks at the largest difference in any single direction (horizontal or vertical). Imagine trying to figure out how far two buildings are by only checking the longest side of the blocks between them.</p>
<p><strong>Canberra Distance</strong>: This one gives more weight to differences when values are small. It’s useful when small differences matter a lot in your data.</p>
<p><strong>Binary Distance</strong>: This is used for yes/no or presence/absence type data. It simply compares if two points have the same “yes/no” values.</p>
<p><strong>Minkowski Distance</strong>: This is a general form of both Euclidean and Manhattan distances. By changing a parameter, it can behave like either Euclidean (straight line) or Manhattan (grid-based).</p>
</details>
<details>
<summary>
Agglomeration methods
</summary>
<p><strong>Ward’s Method (ward.D, ward.D2)</strong>: This tries to form groups that minimize the difference within each cluster. It prefers clusters where data points are very similar to each other. It’s great for balanced, compact groups.</p>
<p><strong>Single Linkage (single)</strong>: This method focuses on the smallest distance between points in two clusters. It can create “chains” of points that are loosely connected, leading to long, stretched-out clusters.</p>
<p><strong>Complete Linkage (complete)</strong>: This method uses the largest distance between points in two clusters. It prefers tight, compact clusters, and avoids the stretched-out effect of single linkage.</p>
<p><strong>Average Linkage (average/UPGMA)</strong>: Here, we average the distances between all pairs of points in two clusters. It balances between tight and loose clusters, forming more moderate-sized groups.</p>
<p><strong>McQuitty’s Method (mcquitty/WPGMA)</strong>: Similar to average linkage, but it calculates the average in a slightly different way. It’s another method to balance between close and distant points.</p>
<p><strong>Median Method (median/WPGMC)</strong>: This method looks at the median distances between points, creating balanced clusters that can handle uneven data well.</p>
<p><strong>Centroid Method (centroid/UPGMC)</strong>: This method calculates the “center” of clusters (think of the average location of all points in the cluster) and uses that to decide how to group them.</p>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(luad_expr,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, <span class="co"># set to FALSE if you want to remove the dendograms</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> F, <span class="co"># displaying column names</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> T, <span class="co"># displaying row names</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols =</span> <span class="st">'correlation'</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">'correlation'</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_method =</span> <span class="st">'ward.D'</span>, <span class="co"># how to aggregate rows and columns depending on their distance</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> viridis<span class="sc">::</span><span class="fu">inferno</span>(<span class="dv">100</span>), <span class="co"># choose a colour scale for your data</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.08</span>), <span class="co"># seq produce a vector from -4 to 4 with a step of 0.08 (100 values)</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize =</span> <span class="dv">8</span> <span class="co"># change font size</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>iv)</em> <em>Separate clusters</em></p>
<p>By looking at the help of the function (<code>?pheatmap</code>) or online, identify the parameters (and adapt their values) that:</p>
<ul>
<li>Enable to show distinct clusters, in the example, 6 sample clusters and 4 gene clusters (2 parameters)</li>
</ul>
<details>
<summary>
Answer
</summary>
<pre><code> cutree_rows = NA # Default
 cutree_cols = NA # Default</code></pre>
</details>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(luad_expr,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, <span class="co"># set to FALSE if you want to remove the dendograms</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> F, <span class="co"># displaying column names</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> T, <span class="co"># displaying row names</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols =</span> <span class="st">'correlation'</span>,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">'correlation'</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_row =</span> anno.rows, <span class="co"># row (gene) annotations</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno.columns, <span class="co"># column (sample) annotations</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_colors =</span> colors.anno, <span class="co"># colours for your annotations</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_method =</span> <span class="st">'ward.D'</span>, <span class="co"># how to aggregate rows and columns depending on their distance</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> viridis<span class="sc">::</span><span class="fu">inferno</span>(<span class="dv">100</span>), <span class="co"># choose a colour scale for your data</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.08</span>),</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">cutree_cols =</span> <span class="dv">6</span>, <span class="co"># display column clusters</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">cutree_rows =</span> <span class="dv">4</span>, <span class="co"># display row clusters</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize =</span> <span class="dv">8</span> <span class="co"># change font size</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="some-useful-links" class="level2">
<h2 class="anchored" data-anchor-id="some-useful-links">Some useful links</h2>
<section id="ggplot2" class="level4">
<h4 class="anchored" data-anchor-id="ggplot2">ggplot2</h4>
<p>All about ggplot2 : <a href="https://ggplot2.tidyverse.org/index.html" class="uri">https://ggplot2.tidyverse.org/index.html</a> , <a href="https://r-graph-gallery.com/" class="uri">https://r-graph-gallery.com/</a></p>
<p>Predefined themes: <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="uri">https://ggplot2.tidyverse.org/reference/ggtheme.html</a></p>
<p>More details to customize themes: <a href="http://www.sthda.com/english/wiki/ggplot2-themes-and-background-colors-the-3-elements" class="uri">http://www.sthda.com/english/wiki/ggplot2-themes-and-background-colors-the-3-elements</a></p>
<p>An other tutorial for ggplot2: <a href="https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/" class="uri">https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/</a></p>
<p>Customize colours and predefined palettes: <a href="https://larmarange.github.io/analyse-R/couleurs.html#ggsci">https://larmarange.github.io/analyse-R/couleurs.html</a></p>
</section>
<section id="ggplot2-adds-on" class="level4">
<h4 class="anchored" data-anchor-id="ggplot2-adds-on">ggplot2 adds-on</h4>
<p>Make plots ready for publication with ggpubr: <a href="https://rpkgs.datanovia.com/ggpubr/" class="uri">https://rpkgs.datanovia.com/ggpubr/</a></p>
<p>Univariate analysis of survival differences (KM plots) with survminer: <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html" class="uri">https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html</a></p>
<p>Multivariate survival analysis with ggforest: <a href="https://rpkgs.datanovia.com/survminer/reference/ggforest.html" class="uri">https://rpkgs.datanovia.com/survminer/reference/ggforest.html</a></p>
</section>
<section id="corrplot-and-pheatmap" class="level4">
<h4 class="anchored" data-anchor-id="corrplot-and-pheatmap">corrplot and pheatmap</h4>
<p><a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html" class="uri">https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html</a></p>
<p><a href="https://biostatsquid.com/step-by-step-heatmap-tutorial-with-pheatmap/" class="uri">https://biostatsquid.com/step-by-step-heatmap-tutorial-with-pheatmap/</a></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>